<html>
<head>
<title>Test page</title>
</head>
<body>
	<h1>Test page</h1>

The first time you connect, you can see a 
<p><code>org.glassfish.jersey.server.ContainerException: java.lang.NoClassDefFoundError: com/fasterxml/jackson/module/jaxb/JaxbAnnotationIntrospector
</code></p>

  <table border="1">
  <tr>
  <td>Service Document </td>
  <td>NOT SUPPORTED</td>
  <td><a target="_blank"  href="resources.svc/?">/</a></td>
  </tr>
  
  <tr>
  <td>Metadata </td>
  <td>NOT SUPPORTED</td>
  <td><a target="_blank"  href="resources.svc/$metadata">$metadata</a></td>
  </tr>
  
  <tr>
  <td>Batch</td>
  <td>NOT SUPPORTED</td>
  <td><a target="_blank"  href="resources.svc/$batch">$batch</a></td>
  </tr>
  
  <tr>
  <td>Entity Set</td>
  <td>OK. $format NOT SUPPORTED. Currently JSON only.</td>
  <td><a target="_blank"  href="resources.svc/Foo">Foo</a><br/>
  <a target="_blank"  href="resources.svc/Bar">Bar</a><br/>
  </tr>
  
  <tr>
  <td>Skip <i>n</i> items, top <i>n</i> items, get items count</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo?$skip=2&$top=3&$inlinecount=allpages">Foo?$skip=2&$top=3&$inlinecount=allpages</a></td>
  </tr>
  
  <tr>
  <td>ORDER BY clause</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo?&$orderby=Name asc,Birthday desc">Foo?$orderby=Name asc,Birthday desc</a></td>
  </tr>
  
  <tr>
  <td>WHERE clause</td>
  <td>Basics work. Not sure about more complex things.</td>
  <td><a target="_blank"  href="resources.svc/Foo?$filter=(Height ge 160)and(Age lt 40)">Foo?$filter=(Height ge 160)and(Age lt 40)</a><br/>
      <a target="_blank"  href="resources.svc/Foo?$filter=Name eq 'Goofy'">Foo?$filter=Name eq 'Goofy'</a><br/>
      <a target="_blank"  href="resources.svc/Foo?$filter=Name eq 'Goofy'">Foo?$filter=contains(Name, 'oo')</a><br/>
  </td>
  </tr>
  
  <tr>
  <td>Count</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo/$count">Foo/$count</a></td>
  </tr>
  
  <tr>
  <td>Entity</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo(1)">Foo(1)</a></td>
  </tr>
  
  <tr>
  <td>Primitive property</td>
  <td>OK (what about non-primitive?)</td>
  <td><a target="_blank"  href="resources.svc/Foo(1)/Address">Foo(1)/Address</a></td>
  </tr>
  
  <tr>
  <td>Primitive property (RAW)</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo(1)/Address/$value">Foo(1)/Address/$value</a></td>
  </tr>
  
  <tr>
  <td>Navigation </td>
  <td>NOT SUPPORTED</td>
  <td><a target="_blank"  href="resources.svc/Foo(1)/FavouriteBar">Foo(1)/FavouriteBar</a> is resolved with toString()<br/>
  <a target="_blank"  href="resources.svc/Foo(1)/SomeProperty(0)/SomeOtherProperty">Foo(1)/SomeProperty(0)/SomeOtherProperty</a></td>
  </tr>
  
  <tr>
  <td>Expand sub-items</td>
  <td>NOT SUPPORTED</td>
  <td><a target="_blank"  href="resources.svc/Foo?&$expand=Bars">Foo?$expand=Bars</a><br/>
  <a target="_blank"  href="resources.svc/Foo?&$expand=*">Foo?$expand=*</a></td>
  </tr>
  
  <tr>
  <td>SELECT</td>
  <td>NOT SUPPORTED (OR NOT YET)</td>
  <td><a target="_blank"  href="resources.svc/Foo?$select=Address">Foo?$select=Address</a></td>
  </tr>
  
  <tr>
  <td>JOIN</td>
  <td>NOT SUPPORTED (OR NOT YET)</td>
  <td><a target="_blank"  href="resources.svc/$crossjoin">$crossjoin...</a></td>
  </tr>
  
  <tr>
  <td>LAMBDA: ALL, ANY</td>
  <td>NOT SUPPORTED</td>
  <td>
  
  <a target="_blank"  href="resources.svc/Foo?&$filter=Bars/all(x:x/Description eq 'Roma')">Foo?$filter=Bars/all(x:x/Description eq 'Roma')</a><br/>
  <a target="_blank"  href="resources.svc/Foo?&$filter=Bars/anyl(x:x/Description eq 'Roma')">Foo?$filter=Bars/any(x:x/Description eq 'Roma')</a>
  </td>
  </tr>
  
  <tr>
  <td>Literals</td>
  <td></td>
  <td>Numbers: 1234<br/>
  	Strings: 'abc'<br/>
  	Booleans: True<br/>
  	Dates: 2012-05-29<br/>
  	Timestamps: 2018-01-10T09:24:54Z<br/>
  </td>
  </tr>
  
  <tr>
  <td>INSERT (POST).</td>
  <td>OK.</td>
  <td><a href="#" onclick="insert();return false;">resources.svc/Foo</a></td>
  </tr>
  
  <tr>
  <td>UPDATE (PUT, not PATCH).</td>
  <td>OK. UPDATE ENUM FAILS!</td>
  <td><a href="#" onclick="update();return false;">resources.svc/Foo(1)</a></td>
  </tr>
  
  <tr>
  <td>An example of Function: Clone</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo(1)/Clone" >resources.svc/Foo(1)/Clone</a></td>
  </tr>
  
  <tr>
  <td>Upload binary data<br/> 
  	
  	</td>
  <td>OK</td>
  <td><form
  		action="resources.svc/Foo(1)/Image/Upload"
  		enctype="multipart/form-data"
  		method="POST">
  		<!-- This outer form is actually useless -->
  			<input type="file" name="file" id="file">
  	</form>
  	<a href="#" onclick="upload();return false;" >resources.svc/Foo(1)/Image/Upload</a>
  	</td>
  </tr>
  
  <tr>
  <td>Download binary data<br/> 
  	
  	</td>
  <td>OK</td>
  <td><a target="_blank"  href="resources.svc/Foo(1)/Image/Download" >resources.svc/Foo(1)/Image/Download</a></td>
  </tr>
  
  </table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
function insert() {
	var mydata = {
		name : "Goofy" + Math.round(Math.random()*10000),
		address : "Somewhere 44",
		age :  Math.random()*100
	};
	
	alert("Going to insert " + mydata.name);
	
	$.ajax({
		url: 'resources.svc/Foo',
		type: 'POST',
	    contentType: 'application/json; charset=utf-8',
	    dataType: 'json',
		data: JSON.stringify(mydata),
		success: function(data) {
			alert('Load was performed. data='+JSON.stringify(data));
		},
		error: function(jqXHR, textStatus, errorThrown) {
			alert('Error while loading: ' + errorThrown);
			console.log('OData error was: ' + jqXHR.responseJSON.error.value);
		}
		});
}

function update() {
	var mydata = {
		id : 1,	//redundant, better to leave it
		name : "Mickey" + Math.round(Math.random()*10000),
		address : "Somewhere 44",
		age :  Math.random()*100
		//,nice: "MAYBE"
	};
	
	alert("Going to update record 1 with " + mydata.name);
	
	$.ajax({
		url: 'resources.svc/Foo(1)',
		type: 'PUT',
	    contentType: 'application/json; charset=utf-8',
	    dataType: 'json',
		data: JSON.stringify(mydata),
		success: function(data) {
			alert('Load was performed. data='+JSON.stringify(data));
		},
		error: function(jqXHR, textStatus, errorThrown) {
			alert('Error while loading: ' + errorThrown);
			console.log('OData error was: ' + jqXHR.responseJSON.error.value);
		}
		});
}

function upload() {

	alert("Going to upload your file...");

	var mydata = new FormData();
	mydata.append('file', $('#file')[0].files[0]);

	$.ajax({
		url: 'resources.svc/Foo(1)/Image/Upload',
		type: 'POST',
		method: 'POST',
		cache: false,
	    contentType: false,
	    processData: false,
		data: mydata,
		success: function(data) {
			alert('Done.');
		},
		error: function(jqXHR, textStatus, errorThrown) {
			alert('Error while loading: ' + errorThrown);
			console.log('OData error was: ' + jqXHR.responseJSON.error.value);
		}
		});
}

</script>
</body>
</html>